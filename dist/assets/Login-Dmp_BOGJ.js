import{r as o,m as y,o as C,k as M,q as u,u as R,j as e,s as N,v as D,t as I,R as j}from"./index-CzLXBV8w.js";import{U as z}from"./user-CAR7-Ft-.js";function O(){const[d,P]=o.useState(y),[a,S]=o.useState(""),[c,E]=o.useState(""),[p,t]=o.useState(""),[m,l]=o.useState(""),[x,g]=o.useState(!1),f=C(),i=M(),b=u(s=>s.login),h=u(s=>s.sessionExpired),w=u(s=>s.clearSessionExpired),{settings:A,updateSettings:L}=R(),r=!A.adminPassword;o.useEffect(()=>{if(i.state&&typeof i.state.reason=="string"){const s=i.state.reason;s==="expired"&&l("Your session expired. Please log in again."),s==="password-updated"&&l("Password updated. Please log in again.")}},[i.state]),o.useEffect(()=>{h&&(l("Your session expired. Please log in again."),w())},[w,h]);const U=async s=>{s.preventDefault(),t(""),l(""),g(!0);try{if(r){if(!a||!c){t("Please enter and confirm a new password");return}if(a!==c){t("Passwords do not match");return}const n=D(a);if(!n.valid){t(n.message);return}const k=await I(a);L({adminPassword:k});const v=await b(y,a);v.success?f(j.ADMIN):t(v.error||"Unable to log in after setup")}else{if(!d.trim()||!a.trim()){t("Please enter both username and password");return}const n=await b(d.trim(),a);n.success?f(j.ADMIN):t(n.error||"Invalid username or password")}}catch(n){t("An error occurred. Please try again."),console.error("Login error:",n)}finally{g(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-purple-100",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg w-full max-w-md border-4 border-pink-500",children:[e.jsx("h2",{className:"text-2xl font-bold text-center text-purple-600 mb-6",children:r?"Set Admin Password":"Admin Login"}),m&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded mb-4",children:m}),p&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:p}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[!r&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",value:d,onChange:s=>P(s.target.value),className:"w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Enter username"})]})]}),r&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 text-purple-700 px-4 py-3 rounded text-sm",children:["Admin username is ",e.jsx("span",{className:"font-semibold",children:"admin"}),". Set a password to continue."]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:r?"New Password":"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"password",value:a,onChange:s=>S(s.target.value),className:"w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:r?"Create a strong password":"Enter password"})]})]}),r&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"password",value:c,onChange:s=>E(s.target.value),className:"w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Re-enter password"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Minimum 10 characters with letters and numbers."})]}),e.jsx("button",{type:"submit",disabled:x,className:"w-full bg-purple-600 text-white py-2 px-4 rounded-lg hover:bg-purple-700 transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed",children:x?r?"Saving...":"Logging in...":r?"Set Password":"Login"})]})]})})}export{O as default};
